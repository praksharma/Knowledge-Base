
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Contour Detection from STFT &#8212; My Jupyter Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Theory/3. MHD modes/6. Contour detection';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Python Libraries" href="../../Libraries/Python/intro.html" />
    <link rel="prev" title="Ridge detection" href="5.%20Ridge%20detection.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/kb_logo.png" class="logo__image only-light" alt=""/>
    <img src="../../_static/kb_logo.png" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">Knowledge Base</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../0.%20Common/intro.html">
    Common
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../1.%20Disruption/intro.html">
    Disruption
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../2.%20ELMs/intro.html">
    ELMs
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="intro.html">
    MHD Modes
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../Libraries/Python/intro.html">
    Python Libraries
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../ML_models/intro.html">
    ML Models
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://github.com/praksharma">
    GitHub Profile
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/praksharma/Knowledge-Base" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../0.%20Common/intro.html">
    Common
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../1.%20Disruption/intro.html">
    Disruption
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../2.%20ELMs/intro.html">
    ELMs
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="intro.html">
    MHD Modes
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../Libraries/Python/intro.html">
    Python Libraries
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../ML_models/intro.html">
    ML Models
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://github.com/praksharma">
    GitHub Profile
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/praksharma/Knowledge-Base" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1.%20MHD.html">Magnetohydrodynamic (MHD) modes</a></li>

<li class="toctree-l1"><a class="reference internal" href="2.%20Paper1.html">Paper 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="3.%20Mirnov_coil.html">Mirnov coils</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.%20Thresholding.html">Thresholding</a></li>
<li class="toctree-l1"><a class="reference internal" href="5.%20Ridge%20detection.html">Ridge detection</a></li>

<li class="toctree-l1 current active"><a class="current reference internal" href="#">Contour Detection from STFT</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../intro.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="intro.html" class="nav-link">MHD Modes</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Contour Detection from STFT</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="contour-detection-from-stft">
<h1>Contour Detection from STFT<a class="headerlink" href="#contour-detection-from-stft" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>Detect closed contours over STFT magnitude (e.g., |Zxx| &gt; 1e-3).</p></li>
<li><p>I can extract their area, duration, central frequency, etc.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">zarr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">zarr.storage</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">fsspec</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="kn">import</span> <span class="n">LogNorm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.signal</span><span class="w"> </span><span class="kn">import</span> <span class="n">stft</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">skimage</span><span class="w"> </span><span class="kn">import</span> <span class="n">measure</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># List of shot IDs</span>
<span class="n">shot_ids</span> <span class="o">=</span> <span class="p">[</span><span class="mi">23447</span><span class="p">,</span> <span class="mi">30005</span><span class="p">,</span> <span class="mi">30021</span><span class="p">,</span> <span class="mi">30421</span><span class="p">]</span>  <span class="c1"># Add more as needed</span>

<span class="c1"># S3 endpoint</span>
<span class="n">endpoint</span> <span class="o">=</span> <span class="s2">&quot;https://s3.echo.stfc.ac.uk&quot;</span>
<span class="n">fs</span> <span class="o">=</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">filesystem</span><span class="p">(</span>
    <span class="n">protocol</span><span class="o">=</span><span class="s1">&#39;simplecache&#39;</span><span class="p">,</span>
    <span class="n">target_protocol</span><span class="o">=</span><span class="s2">&quot;s3&quot;</span><span class="p">,</span>
    <span class="n">target_options</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">anon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">endpoint_url</span><span class="o">=</span><span class="n">endpoint</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">zgroup_list</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loop through each shot ID</span>
<span class="k">for</span> <span class="n">shot_id</span> <span class="ow">in</span> <span class="n">shot_ids</span><span class="p">:</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;s3://mast/level2/shots/</span><span class="si">{</span><span class="n">shot_id</span><span class="si">}</span><span class="s2">.zarr&quot;</span>
    
    <span class="n">store</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">FSStore</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
    <span class="n">store_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
    <span class="c1"># open or download the Zarr group</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">zgroup_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zarr</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">store</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded shot ID </span><span class="si">{</span><span class="n">shot_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Do something with zgroup here, like listing arrays:</span>
        <span class="c1"># print(list(zgroup.array_keys()))</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load shot ID </span><span class="si">{</span><span class="n">shot_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loaded shot ID 23447
Loaded shot ID 30005
Loaded shot ID 30021
Loaded shot ID 30421
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for store in zgroup:</span>
<span class="c1">#     root = zarr.open_group(store, mode=&#39;r&#39;)</span>
<span class="n">mirnov</span> <span class="o">=</span> <span class="p">[</span><span class="n">xr</span><span class="o">.</span><span class="n">open_zarr</span><span class="p">(</span><span class="n">store</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s2">&quot;magnetics&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="n">store_list</span><span class="p">]</span>
<span class="n">mirnov</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme="dark"],
html[data-theme="dark"],
body[data-theme="dark"],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1f1f1f;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: inline-block;
  opacity: 0;
  height: 0;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:focus + label {
  border: 2px solid var(--xr-font-color0);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: "►";
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: "▼";
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: "(";
}

.xr-dim-list:after {
  content: ")";
}

.xr-dim-list li:not(:last-child):after {
  content: ",";
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt; Size: 32MB
Dimensions:                                   (b_field_pol_probe_cc_channel: 5,
                                               time_mirnov: 261200,
                                               b_field_pol_probe_ccbv_channel: 40,
                                               time: 2612,
                                               b_field_pol_probe_obr_channel: 18,
                                               b_field_pol_probe_obv_channel: 18,
                                               b_field_pol_probe_omv_channel: 3,
                                               b_field_tor_probe_cc_channel: 3,
                                               b_field_tor_probe_saddle_field_channel: 12,
                                               time_saddle: 26120,
                                               b_field_tor_probe_saddle_voltage_channel: 12,
                                               flux_loop_channel: 15)
Coordinates:
  * b_field_pol_probe_cc_channel              (b_field_pol_probe_cc_channel) &lt;U13 260B ...
  * b_field_pol_probe_ccbv_channel            (b_field_pol_probe_ccbv_channel) &lt;U10 2kB ...
  * b_field_pol_probe_obr_channel             (b_field_pol_probe_obr_channel) &lt;U9 648B ...
  * b_field_pol_probe_obv_channel             (b_field_pol_probe_obv_channel) &lt;U9 648B ...
  * b_field_pol_probe_omv_channel             (b_field_pol_probe_omv_channel) &lt;U11 132B ...
  * b_field_tor_probe_cc_channel              (b_field_tor_probe_cc_channel) &lt;U13 156B ...
  * b_field_tor_probe_saddle_field_channel    (b_field_tor_probe_saddle_field_channel) &lt;U11 528B ...
  * b_field_tor_probe_saddle_voltage_channel  (b_field_tor_probe_saddle_voltage_channel) &lt;U15 720B ...
  * flux_loop_channel                         (flux_loop_channel) &lt;U12 720B &#x27;...
  * time                                      (time) float64 21kB -0.099 ... ...
  * time_mirnov                               (time_mirnov) float64 2MB -0.09...
  * time_saddle                               (time_saddle) float64 209kB -0....
Data variables:
    b_field_pol_probe_cc_field                (b_field_pol_probe_cc_channel, time_mirnov) float64 10MB ...
    b_field_pol_probe_ccbv_field              (b_field_pol_probe_ccbv_channel, time) float64 836kB ...
    b_field_pol_probe_obr_field               (b_field_pol_probe_obr_channel, time) float64 376kB ...
    b_field_pol_probe_obv_field               (b_field_pol_probe_obv_channel, time) float64 376kB ...
    b_field_pol_probe_omv_voltage             (b_field_pol_probe_omv_channel, time_mirnov) float64 6MB ...
    b_field_tor_probe_cc_field                (b_field_tor_probe_cc_channel, time_mirnov) float64 6MB ...
    b_field_tor_probe_saddle_field            (b_field_tor_probe_saddle_field_channel, time_saddle) float64 3MB ...
    b_field_tor_probe_saddle_voltage          (b_field_tor_probe_saddle_voltage_channel, time_saddle) float64 3MB ...
    flux_loop_flux                            (flux_loop_channel, time) float64 313kB ...
    ip                                        (time) float64 21kB ...
Attributes:
    description:  
    imas:         magnetics
    label:        Plasma Current
    name:         magnetics
    uda_name:     AMC_PLASMA CURRENT
    units:        A</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-2f6d0296-21b7-462a-873d-8dbf6c6e88e8' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-2f6d0296-21b7-462a-873d-8dbf6c6e88e8' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>b_field_pol_probe_cc_channel</span>: 5</li><li><span class='xr-has-index'>time_mirnov</span>: 261200</li><li><span class='xr-has-index'>b_field_pol_probe_ccbv_channel</span>: 40</li><li><span class='xr-has-index'>time</span>: 2612</li><li><span class='xr-has-index'>b_field_pol_probe_obr_channel</span>: 18</li><li><span class='xr-has-index'>b_field_pol_probe_obv_channel</span>: 18</li><li><span class='xr-has-index'>b_field_pol_probe_omv_channel</span>: 3</li><li><span class='xr-has-index'>b_field_tor_probe_cc_channel</span>: 3</li><li><span class='xr-has-index'>b_field_tor_probe_saddle_field_channel</span>: 12</li><li><span class='xr-has-index'>time_saddle</span>: 26120</li><li><span class='xr-has-index'>b_field_tor_probe_saddle_voltage_channel</span>: 12</li><li><span class='xr-has-index'>flux_loop_channel</span>: 15</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-0c8b882e-6e8c-4d6a-a4e4-b6af3844a78f' class='xr-section-summary-in' type='checkbox'  checked><label for='section-0c8b882e-6e8c-4d6a-a4e4-b6af3844a78f' class='xr-section-summary' >Coordinates: <span>(12)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>b_field_pol_probe_cc_channel</span></div><div class='xr-var-dims'>(b_field_pol_probe_cc_channel)</div><div class='xr-var-dtype'>&lt;U13</div><div class='xr-var-preview xr-preview'>&#x27;XMC_CC/MV/201&#x27; ... &#x27;XMC_CC/MV/240&#x27;</div><input id='attrs-48d57ce6-c067-49fb-9e8d-81adc2804131' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-48d57ce6-c067-49fb-9e8d-81adc2804131' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ec3a8678-059c-43e7-bac2-068e5f730035' class='xr-var-data-in' type='checkbox'><label for='data-ec3a8678-059c-43e7-bac2-068e5f730035' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;XMC_CC/MV/201&#x27;, &#x27;XMC_CC/MV/210&#x27;, &#x27;XMC_CC/MV/220&#x27;, &#x27;XMC_CC/MV/230&#x27;,
       &#x27;XMC_CC/MV/240&#x27;], dtype=&#x27;&lt;U13&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>b_field_pol_probe_ccbv_channel</span></div><div class='xr-var-dims'>(b_field_pol_probe_ccbv_channel)</div><div class='xr-var-dtype'>&lt;U10</div><div class='xr-var-preview xr-preview'>&#x27;AMB_CCBV01&#x27; ... &#x27;AMB_CCBV40&#x27;</div><input id='attrs-58b660a8-d92d-453c-b43c-f9614655e2ea' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-58b660a8-d92d-453c-b43c-f9614655e2ea' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a39b3565-42c7-4c68-94e6-36aa11b41ac1' class='xr-var-data-in' type='checkbox'><label for='data-a39b3565-42c7-4c68-94e6-36aa11b41ac1' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;AMB_CCBV01&#x27;, &#x27;AMB_CCBV02&#x27;, &#x27;AMB_CCBV03&#x27;, &#x27;AMB_CCBV04&#x27;, &#x27;AMB_CCBV05&#x27;,
       &#x27;AMB_CCBV06&#x27;, &#x27;AMB_CCBV07&#x27;, &#x27;AMB_CCBV08&#x27;, &#x27;AMB_CCBV09&#x27;, &#x27;AMB_CCBV10&#x27;,
       &#x27;AMB_CCBV11&#x27;, &#x27;AMB_CCBV12&#x27;, &#x27;AMB_CCBV13&#x27;, &#x27;AMB_CCBV14&#x27;, &#x27;AMB_CCBV15&#x27;,
       &#x27;AMB_CCBV16&#x27;, &#x27;AMB_CCBV17&#x27;, &#x27;AMB_CCBV18&#x27;, &#x27;AMB_CCBV19&#x27;, &#x27;AMB_CCBV20&#x27;,
       &#x27;AMB_CCBV21&#x27;, &#x27;AMB_CCBV22&#x27;, &#x27;AMB_CCBV23&#x27;, &#x27;AMB_CCBV24&#x27;, &#x27;AMB_CCBV25&#x27;,
       &#x27;AMB_CCBV26&#x27;, &#x27;AMB_CCBV27&#x27;, &#x27;AMB_CCBV28&#x27;, &#x27;AMB_CCBV29&#x27;, &#x27;AMB_CCBV30&#x27;,
       &#x27;AMB_CCBV31&#x27;, &#x27;AMB_CCBV32&#x27;, &#x27;AMB_CCBV33&#x27;, &#x27;AMB_CCBV34&#x27;, &#x27;AMB_CCBV35&#x27;,
       &#x27;AMB_CCBV36&#x27;, &#x27;AMB_CCBV37&#x27;, &#x27;AMB_CCBV38&#x27;, &#x27;AMB_CCBV39&#x27;, &#x27;AMB_CCBV40&#x27;],
      dtype=&#x27;&lt;U10&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>b_field_pol_probe_obr_channel</span></div><div class='xr-var-dims'>(b_field_pol_probe_obr_channel)</div><div class='xr-var-dtype'>&lt;U9</div><div class='xr-var-preview xr-preview'>&#x27;AMB_OBR01&#x27; ... &#x27;AMB_OBR18&#x27;</div><input id='attrs-cdb5237e-c9ff-4118-ab7b-129b24cf37c6' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-cdb5237e-c9ff-4118-ab7b-129b24cf37c6' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-fe11ece4-fcd4-4f2e-b82a-c11531e0e0ee' class='xr-var-data-in' type='checkbox'><label for='data-fe11ece4-fcd4-4f2e-b82a-c11531e0e0ee' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;AMB_OBR01&#x27;, &#x27;AMB_OBR02&#x27;, &#x27;AMB_OBR03&#x27;, &#x27;AMB_OBR04&#x27;, &#x27;AMB_OBR05&#x27;,
       &#x27;AMB_OBR06&#x27;, &#x27;AMB_OBR07&#x27;, &#x27;AMB_OBR08&#x27;, &#x27;AMB_OBR09&#x27;, &#x27;AMB_OBR10&#x27;,
       &#x27;AMB_OBR11&#x27;, &#x27;AMB_OBR12&#x27;, &#x27;AMB_OBR13&#x27;, &#x27;AMB_OBR14&#x27;, &#x27;AMB_OBR15&#x27;,
       &#x27;AMB_OBR16&#x27;, &#x27;AMB_OBR17&#x27;, &#x27;AMB_OBR18&#x27;], dtype=&#x27;&lt;U9&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>b_field_pol_probe_obv_channel</span></div><div class='xr-var-dims'>(b_field_pol_probe_obv_channel)</div><div class='xr-var-dtype'>&lt;U9</div><div class='xr-var-preview xr-preview'>&#x27;AMB_OBV01&#x27; ... &#x27;AMB_OBV18&#x27;</div><input id='attrs-af3ccaf6-9c53-486e-9045-6a5f20dd2e89' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-af3ccaf6-9c53-486e-9045-6a5f20dd2e89' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a9434ca5-1491-47a9-a5d1-d881c0558497' class='xr-var-data-in' type='checkbox'><label for='data-a9434ca5-1491-47a9-a5d1-d881c0558497' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;AMB_OBV01&#x27;, &#x27;AMB_OBV02&#x27;, &#x27;AMB_OBV03&#x27;, &#x27;AMB_OBV04&#x27;, &#x27;AMB_OBV05&#x27;,
       &#x27;AMB_OBV06&#x27;, &#x27;AMB_OBV07&#x27;, &#x27;AMB_OBV08&#x27;, &#x27;AMB_OBV09&#x27;, &#x27;AMB_OBV10&#x27;,
       &#x27;AMB_OBV11&#x27;, &#x27;AMB_OBV12&#x27;, &#x27;AMB_OBV13&#x27;, &#x27;AMB_OBV14&#x27;, &#x27;AMB_OBV15&#x27;,
       &#x27;AMB_OBV16&#x27;, &#x27;AMB_OBV17&#x27;, &#x27;AMB_OBV18&#x27;], dtype=&#x27;&lt;U9&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>b_field_pol_probe_omv_channel</span></div><div class='xr-var-dims'>(b_field_pol_probe_omv_channel)</div><div class='xr-var-dtype'>&lt;U11</div><div class='xr-var-preview xr-preview'>&#x27;XMC_OMV/110&#x27; ... &#x27;XMC_OMV/310&#x27;</div><input id='attrs-d5f54570-ffe4-47b4-b852-e126f03643d5' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-d5f54570-ffe4-47b4-b852-e126f03643d5' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e84620fc-edd1-4226-a762-0ea44054a102' class='xr-var-data-in' type='checkbox'><label for='data-e84620fc-edd1-4226-a762-0ea44054a102' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;XMC_OMV/110&#x27;, &#x27;XMC_OMV/210&#x27;, &#x27;XMC_OMV/310&#x27;], dtype=&#x27;&lt;U11&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>b_field_tor_probe_cc_channel</span></div><div class='xr-var-dims'>(b_field_tor_probe_cc_channel)</div><div class='xr-var-dtype'>&lt;U13</div><div class='xr-var-preview xr-preview'>&#x27;XMC_CC/MT/201&#x27; ... &#x27;XMC_CC/MT/212&#x27;</div><input id='attrs-cc3330f5-6571-4940-9efb-e79176ac5e49' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-cc3330f5-6571-4940-9efb-e79176ac5e49' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7e68bd36-c9f7-48c7-996f-a9147757dfef' class='xr-var-data-in' type='checkbox'><label for='data-7e68bd36-c9f7-48c7-996f-a9147757dfef' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;XMC_CC/MT/201&#x27;, &#x27;XMC_CC/MT/206&#x27;, &#x27;XMC_CC/MT/212&#x27;], dtype=&#x27;&lt;U13&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>b_field_tor_probe_saddle_field_channel</span></div><div class='xr-var-dims'>(b_field_tor_probe_saddle_field_channel)</div><div class='xr-var-dtype'>&lt;U11</div><div class='xr-var-preview xr-preview'>&#x27;ASM_SAD/M01&#x27; ... &#x27;ASM_SAD/M12&#x27;</div><input id='attrs-edf80e38-8dc3-4dea-8d23-f5d50d5bc207' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-edf80e38-8dc3-4dea-8d23-f5d50d5bc207' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-17c33f82-6c0d-4675-8185-304cd59bbf74' class='xr-var-data-in' type='checkbox'><label for='data-17c33f82-6c0d-4675-8185-304cd59bbf74' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;ASM_SAD/M01&#x27;, &#x27;ASM_SAD/M02&#x27;, &#x27;ASM_SAD/M03&#x27;, &#x27;ASM_SAD/M04&#x27;,
       &#x27;ASM_SAD/M05&#x27;, &#x27;ASM_SAD/M06&#x27;, &#x27;ASM_SAD/M07&#x27;, &#x27;ASM_SAD/M08&#x27;,
       &#x27;ASM_SAD/M09&#x27;, &#x27;ASM_SAD/M10&#x27;, &#x27;ASM_SAD/M11&#x27;, &#x27;ASM_SAD/M12&#x27;],
      dtype=&#x27;&lt;U11&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>b_field_tor_probe_saddle_voltage_channel</span></div><div class='xr-var-dims'>(b_field_tor_probe_saddle_voltage_channel)</div><div class='xr-var-dtype'>&lt;U15</div><div class='xr-var-preview xr-preview'>&#x27;XMB_SAD/OUT/M01&#x27; ... &#x27;XMB_SAD/O...</div><input id='attrs-c35240a1-4904-4266-9262-a644675f5301' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-c35240a1-4904-4266-9262-a644675f5301' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-2bc515bc-64a9-4d14-81af-e07e03bd4bfd' class='xr-var-data-in' type='checkbox'><label for='data-2bc515bc-64a9-4d14-81af-e07e03bd4bfd' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;XMB_SAD/OUT/M01&#x27;, &#x27;XMB_SAD/OUT/M02&#x27;, &#x27;XMB_SAD/OUT/M03&#x27;,
       &#x27;XMB_SAD/OUT/M04&#x27;, &#x27;XMB_SAD/OUT/M05&#x27;, &#x27;XMB_SAD/OUT/M06&#x27;,
       &#x27;XMB_SAD/OUT/M07&#x27;, &#x27;XMB_SAD/OUT/M08&#x27;, &#x27;XMB_SAD/OUT/M09&#x27;,
       &#x27;XMB_SAD/OUT/M10&#x27;, &#x27;XMB_SAD/OUT/M11&#x27;, &#x27;XMB_SAD/OUT/M12&#x27;], dtype=&#x27;&lt;U15&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>flux_loop_channel</span></div><div class='xr-var-dims'>(flux_loop_channel)</div><div class='xr-var-dtype'>&lt;U12</div><div class='xr-var-preview xr-preview'>&#x27;AMB_FL/CC03&#x27; ... &#x27;AMB_FL/P6L/1&#x27;</div><input id='attrs-be2485cb-7e34-4597-9c57-54247308f2ff' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-be2485cb-7e34-4597-9c57-54247308f2ff' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-20a80237-1009-4d83-9cd1-d05d8236df75' class='xr-var-data-in' type='checkbox'><label for='data-20a80237-1009-4d83-9cd1-d05d8236df75' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;AMB_FL/CC03&#x27;, &#x27;AMB_FL/CC04&#x27;, &#x27;AMB_FL/CC05&#x27;, &#x27;AMB_FL/CC07&#x27;,
       &#x27;AMB_FL/CC09&#x27;, &#x27;AMB_FL/P3L/4&#x27;, &#x27;AMB_FL/P3U/1&#x27;, &#x27;AMB_FL/P3U/4&#x27;,
       &#x27;AMB_FL/P4L/1&#x27;, &#x27;AMB_FL/P4L/4&#x27;, &#x27;AMB_FL/P4U/4&#x27;, &#x27;AMB_FL/P5L/1&#x27;,
       &#x27;AMB_FL/P5L/4&#x27;, &#x27;AMB_FL/P5U/1&#x27;, &#x27;AMB_FL/P6L/1&#x27;], dtype=&#x27;&lt;U12&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-0.099 -0.0988 ... 0.423 0.4232</div><input id='attrs-d6c07298-1c18-4d14-9b9c-8b9764e82a20' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-d6c07298-1c18-4d14-9b9c-8b9764e82a20' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c7a3fccd-5c51-4a23-8b84-13e738100ef0' class='xr-var-data-in' type='checkbox'><label for='data-c7a3fccd-5c51-4a23-8b84-13e738100ef0' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>s</dd></dl></div><div class='xr-var-data'><pre>array([-0.099 , -0.0988, -0.0986, ...,  0.4228,  0.423 ,  0.4232],
      shape=(2612,))</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time_mirnov</span></div><div class='xr-var-dims'>(time_mirnov)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-0.099 -0.099 ... 0.4234 0.4234</div><input id='attrs-7f2e22a9-a2da-4c3b-b393-c13c6d9847b9' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-7f2e22a9-a2da-4c3b-b393-c13c6d9847b9' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f9785133-384f-48af-92ee-f592969733ce' class='xr-var-data-in' type='checkbox'><label for='data-f9785133-384f-48af-92ee-f592969733ce' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>s</dd></dl></div><div class='xr-var-data'><pre>array([-0.099   , -0.098998, -0.098996, ...,  0.423394,  0.423396,  0.423398],
      shape=(261200,))</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time_saddle</span></div><div class='xr-var-dims'>(time_saddle)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-0.099 -0.09898 ... 0.4234 0.4234</div><input id='attrs-76692975-d141-45f7-bef4-e400d83c6bb5' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-76692975-d141-45f7-bef4-e400d83c6bb5' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-87184805-45b5-465c-bfd8-b9eb858ced5d' class='xr-var-data-in' type='checkbox'><label for='data-87184805-45b5-465c-bfd8-b9eb858ced5d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>s</dd></dl></div><div class='xr-var-data'><pre>array([-0.099  , -0.09898, -0.09896, ...,  0.42334,  0.42336,  0.42338],
      shape=(26120,))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-c7d9cd7c-30a5-4afd-8fdc-4a67cd4daf55' class='xr-section-summary-in' type='checkbox'  checked><label for='section-c7d9cd7c-30a5-4afd-8fdc-4a67cd4daf55' class='xr-section-summary' >Data variables: <span>(10)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>b_field_pol_probe_cc_field</span></div><div class='xr-var-dims'>(b_field_pol_probe_cc_channel, time_mirnov)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-b2c985d0-5c2c-4c48-9b25-966fee204e0e' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-b2c985d0-5c2c-4c48-9b25-966fee204e0e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-02426d1c-0704-41bd-84c0-c7545dd39a31' class='xr-var-data-in' type='checkbox'><label for='data-02426d1c-0704-41bd-84c0-c7545dd39a31' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>description :</span></dt><dd>Centre column poloidal mirnov array</dd><dt><span>imas :</span></dt><dd>magnetics.b_field_pol_probe[:].field.data</dd><dt><span>label :</span></dt><dd>Tesla/sec</dd><dt><span>name :</span></dt><dd>b_field_pol_probe_cc_field</dd><dt><span>uda_name :</span></dt><dd>XMC_CC/MV/201</dd><dt><span>units :</span></dt><dd>T</dd></dl></div><div class='xr-var-data'><pre>[1306000 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>b_field_pol_probe_ccbv_field</span></div><div class='xr-var-dims'>(b_field_pol_probe_ccbv_channel, time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-d065b621-80e6-421b-863d-77d66ed6929d' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-d065b621-80e6-421b-863d-77d66ed6929d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-dd52627f-a66c-4e85-8a6a-7109e2065515' class='xr-var-data-in' type='checkbox'><label for='data-dd52627f-a66c-4e85-8a6a-7109e2065515' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>description :</span></dt><dd>Centre column Bv array</dd><dt><span>imas :</span></dt><dd>magnetics.b_field_pol_probe[:].field.data</dd><dt><span>label :</span></dt><dd>CCBV01</dd><dt><span>name :</span></dt><dd>b_field_pol_probe_ccbv_field</dd><dt><span>uda_name :</span></dt><dd>AMB_CCBV01</dd><dt><span>units :</span></dt><dd>T</dd></dl></div><div class='xr-var-data'><pre>[104480 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>b_field_pol_probe_obr_field</span></div><div class='xr-var-dims'>(b_field_pol_probe_obr_channel, time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-ad35c862-f9b7-4295-9673-251fb27d1047' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-ad35c862-f9b7-4295-9673-251fb27d1047' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-0b8a0182-d8ce-4fb3-abb9-af595b3b4f7d' class='xr-var-data-in' type='checkbox'><label for='data-0b8a0182-d8ce-4fb3-abb9-af595b3b4f7d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>description :</span></dt><dd>Outer Br array</dd><dt><span>imas :</span></dt><dd>magnetics.b_field_pol_probe[:].field.data</dd><dt><span>label :</span></dt><dd>OBR01</dd><dt><span>name :</span></dt><dd>b_field_pol_probe_obr_field</dd><dt><span>uda_name :</span></dt><dd>AMB_OBR01</dd><dt><span>units :</span></dt><dd>T</dd></dl></div><div class='xr-var-data'><pre>[47016 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>b_field_pol_probe_obv_field</span></div><div class='xr-var-dims'>(b_field_pol_probe_obv_channel, time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-b0c1c3b7-611d-4822-9c21-7dbf1cfa2ccc' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-b0c1c3b7-611d-4822-9c21-7dbf1cfa2ccc' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-bb9aaee8-5bf8-486e-bfce-166929e9b7c9' class='xr-var-data-in' type='checkbox'><label for='data-bb9aaee8-5bf8-486e-bfce-166929e9b7c9' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>description :</span></dt><dd>Outer Bv array</dd><dt><span>imas :</span></dt><dd>magnetics.b_field_pol_probe[:].field.data</dd><dt><span>label :</span></dt><dd>OBV01</dd><dt><span>name :</span></dt><dd>b_field_pol_probe_obv_field</dd><dt><span>uda_name :</span></dt><dd>AMB_OBV01</dd><dt><span>units :</span></dt><dd>T</dd></dl></div><div class='xr-var-data'><pre>[47016 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>b_field_pol_probe_omv_voltage</span></div><div class='xr-var-dims'>(b_field_pol_probe_omv_channel, time_mirnov)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-a7a28dba-0ff0-4289-b2f4-5d879635af99' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-a7a28dba-0ff0-4289-b2f4-5d879635af99' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-72868535-1cb3-40e6-9ff6-9789b600e2d4' class='xr-var-data-in' type='checkbox'><label for='data-72868535-1cb3-40e6-9ff6-9789b600e2d4' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>description :</span></dt><dd>Outboard vertical mirnov array</dd><dt><span>imas :</span></dt><dd>magnetics.b_field_tor_probe[:].voltage.data</dd><dt><span>label :</span></dt><dd>Volt</dd><dt><span>name :</span></dt><dd>b_field_pol_probe_omv_voltage</dd><dt><span>uda_name :</span></dt><dd>XMC_OMV/110</dd><dt><span>units :</span></dt><dd>V</dd></dl></div><div class='xr-var-data'><pre>[783600 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>b_field_tor_probe_cc_field</span></div><div class='xr-var-dims'>(b_field_tor_probe_cc_channel, time_mirnov)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-204145f4-c281-4d23-a67d-c5fb8c9ba411' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-204145f4-c281-4d23-a67d-c5fb8c9ba411' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-62c83ac8-dd9d-4cf3-baa4-de549ca9d4c2' class='xr-var-data-in' type='checkbox'><label for='data-62c83ac8-dd9d-4cf3-baa4-de549ca9d4c2' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>description :</span></dt><dd>Centre column toroidal mirnov array</dd><dt><span>imas :</span></dt><dd>magnetics.b_field_tor_probe[:].field.data</dd><dt><span>label :</span></dt><dd>Tesla/sec</dd><dt><span>name :</span></dt><dd>b_field_tor_probe_cc_field</dd><dt><span>uda_name :</span></dt><dd>XMC_CC/MT/201</dd><dt><span>units :</span></dt><dd>T</dd></dl></div><div class='xr-var-data'><pre>[783600 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>b_field_tor_probe_saddle_field</span></div><div class='xr-var-dims'>(b_field_tor_probe_saddle_field_channel, time_saddle)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-dcd11298-ce69-4bf6-98ba-233236c71577' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-dcd11298-ce69-4bf6-98ba-233236c71577' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-260f8e86-2c65-4392-b0dc-05e90f26c120' class='xr-var-data-in' type='checkbox'><label for='data-260f8e86-2c65-4392-b0dc-05e90f26c120' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>description :</span></dt><dd></dd><dt><span>imas :</span></dt><dd>magnetics.b_field_tor_probe[:].field.data</dd><dt><span>label :</span></dt><dd>mT</dd><dt><span>name :</span></dt><dd>b_field_tor_probe_saddle_field</dd><dt><span>uda_name :</span></dt><dd>ASM_SAD/M01</dd><dt><span>units :</span></dt><dd>T</dd></dl></div><div class='xr-var-data'><pre>[313440 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>b_field_tor_probe_saddle_voltage</span></div><div class='xr-var-dims'>(b_field_tor_probe_saddle_voltage_channel, time_saddle)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-c2ca2391-9d36-4bed-92f2-75ef32251785' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-c2ca2391-9d36-4bed-92f2-75ef32251785' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9db7ccad-fee1-411a-9ee6-3560a778f9ef' class='xr-var-data-in' type='checkbox'><label for='data-9db7ccad-fee1-411a-9ee6-3560a778f9ef' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>description :</span></dt><dd></dd><dt><span>imas :</span></dt><dd>magnetics.b_field_tor_probe[:].voltage.data</dd><dt><span>label :</span></dt><dd>V</dd><dt><span>name :</span></dt><dd>b_field_tor_probe_saddle_voltage</dd><dt><span>uda_name :</span></dt><dd>XMB_SAD/OUT/M01</dd><dt><span>units :</span></dt><dd>V</dd></dl></div><div class='xr-var-data'><pre>[313440 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>flux_loop_flux</span></div><div class='xr-var-dims'>(flux_loop_channel, time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-77c791d6-16d0-4393-aceb-9c57bae07bf5' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-77c791d6-16d0-4393-aceb-9c57bae07bf5' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c5485697-6b0a-45de-98f8-56a5927dc6b3' class='xr-var-data-in' type='checkbox'><label for='data-c5485697-6b0a-45de-98f8-56a5927dc6b3' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>description :</span></dt><dd></dd><dt><span>imas :</span></dt><dd>magnetics.flux_loop[:].flux.data</dd><dt><span>label :</span></dt><dd>FL/CC03</dd><dt><span>name :</span></dt><dd>flux_loop_flux</dd><dt><span>uda_name :</span></dt><dd>AMB_FL/CC03</dd><dt><span>units :</span></dt><dd>Wb</dd></dl></div><div class='xr-var-data'><pre>[39180 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>ip</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-ec01e6c9-0ed9-4877-a1c6-4f9ee36ae0da' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-ec01e6c9-0ed9-4877-a1c6-4f9ee36ae0da' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8f6abda1-c8cc-44f0-ab9f-e737b272eb15' class='xr-var-data-in' type='checkbox'><label for='data-8f6abda1-c8cc-44f0-ab9f-e737b272eb15' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>description :</span></dt><dd></dd><dt><span>imas :</span></dt><dd>magnetics.ip[:].data</dd><dt><span>label :</span></dt><dd>Plasma Current</dd><dt><span>name :</span></dt><dd>ip</dd><dt><span>uda_name :</span></dt><dd>AMC_PLASMA CURRENT</dd><dt><span>units :</span></dt><dd>A</dd></dl></div><div class='xr-var-data'><pre>[2612 values with dtype=float64]</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-69e2fedd-9656-4f55-9ae6-3c2c8b39f631' class='xr-section-summary-in' type='checkbox'  ><label for='section-69e2fedd-9656-4f55-9ae6-3c2c8b39f631' class='xr-section-summary' >Indexes: <span>(12)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>b_field_pol_probe_cc_channel</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-1ad2e2a7-8ab6-4669-8d1b-44b8a1d65523' class='xr-index-data-in' type='checkbox'/><label for='index-1ad2e2a7-8ab6-4669-8d1b-44b8a1d65523' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;XMC_CC/MV/201&#x27;, &#x27;XMC_CC/MV/210&#x27;, &#x27;XMC_CC/MV/220&#x27;, &#x27;XMC_CC/MV/230&#x27;,
       &#x27;XMC_CC/MV/240&#x27;],
      dtype=&#x27;object&#x27;, name=&#x27;b_field_pol_probe_cc_channel&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>b_field_pol_probe_ccbv_channel</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-2395f18e-7b5c-48d3-994c-908d3e721fc3' class='xr-index-data-in' type='checkbox'/><label for='index-2395f18e-7b5c-48d3-994c-908d3e721fc3' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;AMB_CCBV01&#x27;, &#x27;AMB_CCBV02&#x27;, &#x27;AMB_CCBV03&#x27;, &#x27;AMB_CCBV04&#x27;, &#x27;AMB_CCBV05&#x27;,
       &#x27;AMB_CCBV06&#x27;, &#x27;AMB_CCBV07&#x27;, &#x27;AMB_CCBV08&#x27;, &#x27;AMB_CCBV09&#x27;, &#x27;AMB_CCBV10&#x27;,
       &#x27;AMB_CCBV11&#x27;, &#x27;AMB_CCBV12&#x27;, &#x27;AMB_CCBV13&#x27;, &#x27;AMB_CCBV14&#x27;, &#x27;AMB_CCBV15&#x27;,
       &#x27;AMB_CCBV16&#x27;, &#x27;AMB_CCBV17&#x27;, &#x27;AMB_CCBV18&#x27;, &#x27;AMB_CCBV19&#x27;, &#x27;AMB_CCBV20&#x27;,
       &#x27;AMB_CCBV21&#x27;, &#x27;AMB_CCBV22&#x27;, &#x27;AMB_CCBV23&#x27;, &#x27;AMB_CCBV24&#x27;, &#x27;AMB_CCBV25&#x27;,
       &#x27;AMB_CCBV26&#x27;, &#x27;AMB_CCBV27&#x27;, &#x27;AMB_CCBV28&#x27;, &#x27;AMB_CCBV29&#x27;, &#x27;AMB_CCBV30&#x27;,
       &#x27;AMB_CCBV31&#x27;, &#x27;AMB_CCBV32&#x27;, &#x27;AMB_CCBV33&#x27;, &#x27;AMB_CCBV34&#x27;, &#x27;AMB_CCBV35&#x27;,
       &#x27;AMB_CCBV36&#x27;, &#x27;AMB_CCBV37&#x27;, &#x27;AMB_CCBV38&#x27;, &#x27;AMB_CCBV39&#x27;, &#x27;AMB_CCBV40&#x27;],
      dtype=&#x27;object&#x27;, name=&#x27;b_field_pol_probe_ccbv_channel&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>b_field_pol_probe_obr_channel</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-cf94162b-a995-4806-a2ff-9f71cc69e7ba' class='xr-index-data-in' type='checkbox'/><label for='index-cf94162b-a995-4806-a2ff-9f71cc69e7ba' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;AMB_OBR01&#x27;, &#x27;AMB_OBR02&#x27;, &#x27;AMB_OBR03&#x27;, &#x27;AMB_OBR04&#x27;, &#x27;AMB_OBR05&#x27;,
       &#x27;AMB_OBR06&#x27;, &#x27;AMB_OBR07&#x27;, &#x27;AMB_OBR08&#x27;, &#x27;AMB_OBR09&#x27;, &#x27;AMB_OBR10&#x27;,
       &#x27;AMB_OBR11&#x27;, &#x27;AMB_OBR12&#x27;, &#x27;AMB_OBR13&#x27;, &#x27;AMB_OBR14&#x27;, &#x27;AMB_OBR15&#x27;,
       &#x27;AMB_OBR16&#x27;, &#x27;AMB_OBR17&#x27;, &#x27;AMB_OBR18&#x27;],
      dtype=&#x27;object&#x27;, name=&#x27;b_field_pol_probe_obr_channel&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>b_field_pol_probe_obv_channel</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-cc4dd83b-67b3-4864-a7b6-b19cfceeb06c' class='xr-index-data-in' type='checkbox'/><label for='index-cc4dd83b-67b3-4864-a7b6-b19cfceeb06c' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;AMB_OBV01&#x27;, &#x27;AMB_OBV02&#x27;, &#x27;AMB_OBV03&#x27;, &#x27;AMB_OBV04&#x27;, &#x27;AMB_OBV05&#x27;,
       &#x27;AMB_OBV06&#x27;, &#x27;AMB_OBV07&#x27;, &#x27;AMB_OBV08&#x27;, &#x27;AMB_OBV09&#x27;, &#x27;AMB_OBV10&#x27;,
       &#x27;AMB_OBV11&#x27;, &#x27;AMB_OBV12&#x27;, &#x27;AMB_OBV13&#x27;, &#x27;AMB_OBV14&#x27;, &#x27;AMB_OBV15&#x27;,
       &#x27;AMB_OBV16&#x27;, &#x27;AMB_OBV17&#x27;, &#x27;AMB_OBV18&#x27;],
      dtype=&#x27;object&#x27;, name=&#x27;b_field_pol_probe_obv_channel&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>b_field_pol_probe_omv_channel</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-ed0c3e33-b421-4fe8-8f56-94182d230cae' class='xr-index-data-in' type='checkbox'/><label for='index-ed0c3e33-b421-4fe8-8f56-94182d230cae' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;XMC_OMV/110&#x27;, &#x27;XMC_OMV/210&#x27;, &#x27;XMC_OMV/310&#x27;], dtype=&#x27;object&#x27;, name=&#x27;b_field_pol_probe_omv_channel&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>b_field_tor_probe_cc_channel</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-7c46e7ba-0fe8-487d-9696-c9989816ff20' class='xr-index-data-in' type='checkbox'/><label for='index-7c46e7ba-0fe8-487d-9696-c9989816ff20' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;XMC_CC/MT/201&#x27;, &#x27;XMC_CC/MT/206&#x27;, &#x27;XMC_CC/MT/212&#x27;], dtype=&#x27;object&#x27;, name=&#x27;b_field_tor_probe_cc_channel&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>b_field_tor_probe_saddle_field_channel</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-116b60cb-d8a9-4584-9ae2-d4a549dc829f' class='xr-index-data-in' type='checkbox'/><label for='index-116b60cb-d8a9-4584-9ae2-d4a549dc829f' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;ASM_SAD/M01&#x27;, &#x27;ASM_SAD/M02&#x27;, &#x27;ASM_SAD/M03&#x27;, &#x27;ASM_SAD/M04&#x27;,
       &#x27;ASM_SAD/M05&#x27;, &#x27;ASM_SAD/M06&#x27;, &#x27;ASM_SAD/M07&#x27;, &#x27;ASM_SAD/M08&#x27;,
       &#x27;ASM_SAD/M09&#x27;, &#x27;ASM_SAD/M10&#x27;, &#x27;ASM_SAD/M11&#x27;, &#x27;ASM_SAD/M12&#x27;],
      dtype=&#x27;object&#x27;, name=&#x27;b_field_tor_probe_saddle_field_channel&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>b_field_tor_probe_saddle_voltage_channel</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-090d7614-5252-4ef5-b692-9cd118b59ad2' class='xr-index-data-in' type='checkbox'/><label for='index-090d7614-5252-4ef5-b692-9cd118b59ad2' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;XMB_SAD/OUT/M01&#x27;, &#x27;XMB_SAD/OUT/M02&#x27;, &#x27;XMB_SAD/OUT/M03&#x27;,
       &#x27;XMB_SAD/OUT/M04&#x27;, &#x27;XMB_SAD/OUT/M05&#x27;, &#x27;XMB_SAD/OUT/M06&#x27;,
       &#x27;XMB_SAD/OUT/M07&#x27;, &#x27;XMB_SAD/OUT/M08&#x27;, &#x27;XMB_SAD/OUT/M09&#x27;,
       &#x27;XMB_SAD/OUT/M10&#x27;, &#x27;XMB_SAD/OUT/M11&#x27;, &#x27;XMB_SAD/OUT/M12&#x27;],
      dtype=&#x27;object&#x27;, name=&#x27;b_field_tor_probe_saddle_voltage_channel&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>flux_loop_channel</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-fceb68ee-a2dc-4290-9cf7-4ff8e88f82a0' class='xr-index-data-in' type='checkbox'/><label for='index-fceb68ee-a2dc-4290-9cf7-4ff8e88f82a0' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;AMB_FL/CC03&#x27;, &#x27;AMB_FL/CC04&#x27;, &#x27;AMB_FL/CC05&#x27;, &#x27;AMB_FL/CC07&#x27;,
       &#x27;AMB_FL/CC09&#x27;, &#x27;AMB_FL/P3L/4&#x27;, &#x27;AMB_FL/P3U/1&#x27;, &#x27;AMB_FL/P3U/4&#x27;,
       &#x27;AMB_FL/P4L/1&#x27;, &#x27;AMB_FL/P4L/4&#x27;, &#x27;AMB_FL/P4U/4&#x27;, &#x27;AMB_FL/P5L/1&#x27;,
       &#x27;AMB_FL/P5L/4&#x27;, &#x27;AMB_FL/P5U/1&#x27;, &#x27;AMB_FL/P6L/1&#x27;],
      dtype=&#x27;object&#x27;, name=&#x27;flux_loop_channel&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-ba7eb2b3-7dfc-4ffc-89a1-1b860c48ab38' class='xr-index-data-in' type='checkbox'/><label for='index-ba7eb2b3-7dfc-4ffc-89a1-1b860c48ab38' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([ -0.0990000069141388, -0.09880000691413879, -0.09860000691413878,
       -0.09840000691413878, -0.09820000691413877, -0.09800000691413877,
       -0.09780000691413876, -0.09760000691413875, -0.09740000691413875,
       -0.09720000691413874,
       ...
        0.42139999308587606,  0.42159999308587615,   0.4217999930858761,
         0.4219999930858761,   0.4221999930858762,  0.42239999308587617,
        0.42259999308587615,   0.4227999930858761,   0.4229999930858761,
         0.4231999930858762],
      dtype=&#x27;float64&#x27;, name=&#x27;time&#x27;, length=2612))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>time_mirnov</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-b77acc69-983d-4e7c-a9e9-d23881f3f908' class='xr-index-data-in' type='checkbox'/><label for='index-b77acc69-983d-4e7c-a9e9-d23881f3f908' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([ -0.0990000069141388, -0.09899800691413879, -0.09899600691413879,
       -0.09899400691413879, -0.09899200691413879, -0.09899000691413878,
       -0.09898800691413878, -0.09898600691413878, -0.09898400691413878,
       -0.09898200691413878,
       ...
        0.42337999308638363,   0.4233819930863836,  0.42338399308638364,
         0.4233859930863837,  0.42338799308638364,   0.4233899930863836,
        0.42339199308638364,   0.4233939930863837,  0.42339599308638365,
         0.4233979930863836],
      dtype=&#x27;float64&#x27;, name=&#x27;time_mirnov&#x27;, length=261200))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>time_saddle</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-d0f19c46-6285-4c7a-a783-83acd363cc09' class='xr-index-data-in' type='checkbox'/><label for='index-d0f19c46-6285-4c7a-a783-83acd363cc09' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([ -0.0990000069141388, -0.09898000691413879, -0.09896000691413878,
       -0.09894000691413878, -0.09892000691413877, -0.09890000691413876,
       -0.09888000691413876, -0.09886000691413875, -0.09884000691413874,
       -0.09882000691413874,
       ...
         0.4231999930860211,   0.4232199930860211,   0.4232399930860211,
        0.42325999308602114,  0.42327999308602116,   0.4232999930860212,
         0.4233199930860212,   0.4233399930860211,   0.4233599930860211,
        0.42337999308602114],
      dtype=&#x27;float64&#x27;, name=&#x27;time_saddle&#x27;, length=26120))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-a7c48e88-94ca-465f-b4bf-711e34971c76' class='xr-section-summary-in' type='checkbox'  checked><label for='section-a7c48e88-94ca-465f-b4bf-711e34971c76' class='xr-section-summary' >Attributes: <span>(6)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>description :</span></dt><dd></dd><dt><span>imas :</span></dt><dd>magnetics</dd><dt><span>label :</span></dt><dd>Plasma Current</dd><dt><span>name :</span></dt><dd>magnetics</dd><dt><span>uda_name :</span></dt><dd>AMC_PLASMA CURRENT</dd><dt><span>units :</span></dt><dd>A</dd></dl></div></li></ul></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract the DataArrays</span>
<span class="n">ds_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;b_field_pol_probe_omv_voltage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">b_field_pol_probe_omv_channel</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mirnov</span><span class="p">]</span>

<span class="c1"># Plot all in one figure</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ds_list</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Shot </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/8fb1e60b4232a66621a4da5771456af08b0cff13735ac3c64081a39b291c3b9b.png" src="../../_images/8fb1e60b4232a66621a4da5771456af08b0cff13735ac3c64081a39b291c3b9b.png" />
<img alt="../../_images/c8af5f987476b86614594f1f669b77bf75a27553c30ef1dd73f3d24eb4d919ad.png" src="../../_images/c8af5f987476b86614594f1f669b77bf75a27553c30ef1dd73f3d24eb4d919ad.png" />
<img alt="../../_images/1fbfa89779911d8c6396a0fb1669ced0f60b321cca67af666cc58483fa3cff48.png" src="../../_images/1fbfa89779911d8c6396a0fb1669ced0f60b321cca67af666cc58483fa3cff48.png" />
<img alt="../../_images/6a9b1fbf7ed2557ab258c9aabbfd730c7179deab62f6d1fec600a7a4f62d6cd6.png" src="../../_images/6a9b1fbf7ed2557ab258c9aabbfd730c7179deab62f6d1fec600a7a4f62d6cd6.png" />
</div>
</div>
<section id="short-time-fourier-transform-stft">
<h2>Short-Time Fourier Transform (STFT)<a class="headerlink" href="#short-time-fourier-transform-stft" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_stft_spectrogram</span><span class="p">(</span>    <span class="n">ds</span><span class="p">,</span>    <span class="n">shot_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>    <span class="n">nperseg</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>    <span class="n">nfft</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>    <span class="n">tmin</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>    <span class="n">tmax</span><span class="o">=</span><span class="mf">0.46</span><span class="p">,</span>    <span class="n">fmax_kHz</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot STFT short time Fourier transform spectrogram for a given xarray DataArray `ds`.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    - ds: xarray.DataArray with a &#39;time_mirnov&#39; coordinate.</span>
<span class="sd">    - shot_id: Optional shot ID for labeling.</span>
<span class="sd">    - nperseg: Number of points per STFT segment.</span>
<span class="sd">    - nfft: Number of FFT points.</span>
<span class="sd">    - tmin, tmax: Time range to display (seconds).</span>
<span class="sd">    - fmax_kHz: Max frequency to display (kHz).</span>
<span class="sd">    - cmap: Colormap name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sample_rate</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time_mirnov</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ds</span><span class="o">.</span><span class="n">time_mirnov</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">Zxx</span> <span class="o">=</span> <span class="n">stft</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">sample_rate</span><span class="p">),</span> <span class="n">nperseg</span><span class="o">=</span><span class="n">nperseg</span><span class="p">,</span> <span class="n">nfft</span><span class="o">=</span><span class="n">nfft</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">cax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
        <span class="n">t</span><span class="p">,</span> <span class="n">f</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Zxx</span><span class="p">),</span>
        <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
        <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fmax_kHz</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency [kHz]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time [sec]&#39;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;STFT Spectrogram&quot;</span>
    <span class="k">if</span> <span class="n">shot_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; - Shot </span><span class="si">{</span><span class="n">shot_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">plot_stft_spectrogram</span><span class="p">(</span><span class="n">ds_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">shot_ids</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ds_list</span><span class="p">))]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[None, None, None, None]
</pre></div>
</div>
<img alt="../../_images/c17b52e0d173da12c6d17afee38b4e094cde8d4da00557feb6fbaf291ea802cb.png" src="../../_images/c17b52e0d173da12c6d17afee38b4e094cde8d4da00557feb6fbaf291ea802cb.png" />
<img alt="../../_images/ed762b82c3fa9f2d731807eee6d583e86e93019ec85f8f8ad8a2a6d567c7c262.png" src="../../_images/ed762b82c3fa9f2d731807eee6d583e86e93019ec85f8f8ad8a2a6d567c7c262.png" />
<img alt="../../_images/30cc300e3f10893e6de096d329a639846fc5174aab723321a9627c2fe135d9f8.png" src="../../_images/30cc300e3f10893e6de096d329a639846fc5174aab723321a9627c2fe135d9f8.png" />
<img alt="../../_images/5100becfcaefdc610237cdadd64ae136681f621bc0aa8365709b13a94614f44b.png" src="../../_images/5100becfcaefdc610237cdadd64ae136681f621bc0aa8365709b13a94614f44b.png" />
</div>
</div>
<section id="inspect-amplitude-distribution">
<h3>Inspect amplitude distribution<a class="headerlink" href="#inspect-amplitude-distribution" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_stft_histogram</span><span class="p">(</span>    <span class="n">ds</span><span class="p">,</span>    <span class="n">shot_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>    <span class="n">nperseg</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>    <span class="n">nfft</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>    <span class="n">bins</span><span class="o">=</span><span class="mi">100</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a histogram of the absolute STFT amplitude values.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - ds: xarray.DataArray with a &#39;time_mirnov&#39; coordinate.</span>
<span class="sd">    - shot_id: Optional shot ID for labeling.</span>
<span class="sd">    - nperseg: Number of points per STFT segment.</span>
<span class="sd">    - nfft: Number of FFT points.</span>
<span class="sd">    - bins: Number of histogram bins.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sample_rate</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time_mirnov</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ds</span><span class="o">.</span><span class="n">time_mirnov</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">Zxx</span> <span class="o">=</span> <span class="n">stft</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">sample_rate</span><span class="p">),</span> <span class="n">nperseg</span><span class="o">=</span><span class="n">nperseg</span><span class="p">,</span> <span class="n">nfft</span><span class="o">=</span><span class="n">nfft</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Zxx</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count (log scale)&#39;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Histogram of Spectrogram Amplitudes&#39;</span>
    <span class="k">if</span> <span class="n">shot_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; - Shot </span><span class="si">{</span><span class="n">shot_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">Zxx</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f_list</span><span class="p">,</span> <span class="n">t_list</span><span class="p">,</span> <span class="n">Zxx_list</span> <span class="o">=</span>  <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ds_list</span><span class="p">):</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">Zxx</span> <span class="o">=</span> <span class="n">plot_stft_histogram</span><span class="p">(</span><span class="n">ds_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">shot_ids</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">f_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">t_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">Zxx_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Zxx</span><span class="p">)</span>

<span class="c1">#[plot_stft_histogram(ds_list[i], shot_ids[i]) for i in range(len(ds_list))]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/e90e279a3cc4cc0d7fad806434ba032342e7892b60cf358ea5bb5a45fbf3bade.png" src="../../_images/e90e279a3cc4cc0d7fad806434ba032342e7892b60cf358ea5bb5a45fbf3bade.png" />
<img alt="../../_images/1e8e995f70704eddd9b00c006dace17736876b6802084bede341531ba4ea8097.png" src="../../_images/1e8e995f70704eddd9b00c006dace17736876b6802084bede341531ba4ea8097.png" />
<img alt="../../_images/1f906a19e864a23391bb6399072e82484297d67c5510ebee8132f2aea812af50.png" src="../../_images/1f906a19e864a23391bb6399072e82484297d67c5510ebee8132f2aea812af50.png" />
<img alt="../../_images/b2d04bae46aeeb9d41047021767121cd8c976e51282d1e1bccb13e1a1202be36.png" src="../../_images/b2d04bae46aeeb9d41047021767121cd8c976e51282d1e1bccb13e1a1202be36.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_stft_contours</span><span class="p">(</span><span class="n">Zxx</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract contour regions from STFT magnitude.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    - Zxx: 2D STFT array (freq x time)</span>
<span class="sd">    - f: frequency array (Hz)</span>
<span class="sd">    - t: time array (sec)</span>
<span class="sd">    - threshold: amplitude threshold for contours</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    - contours: list of Nx2 arrays (y: freq index, x: time index)</span>
<span class="sd">    - f, t can be used to map indices to physical values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">magnitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Zxx</span><span class="p">)</span>
    <span class="n">contours</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">find_contours</span><span class="p">(</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">contours</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_spectrogram_with_contours</span><span class="p">(</span><span class="n">Zxx</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">contours</span><span class="p">,</span> <span class="n">shot_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">):</span>

    <span class="n">f_kHz</span> <span class="o">=</span> <span class="n">f</span> <span class="o">/</span> <span class="mi">1000</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">cax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">f_kHz</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Zxx</span><span class="p">),</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
                        <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">contour</span> <span class="ow">in</span> <span class="n">contours</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">contour</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)],</span>
                <span class="n">f_kHz</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">contour</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)],</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time [sec]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency [kHz]&#39;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;STFT with Contour Overlay&quot;</span>
    <span class="k">if</span> <span class="n">shot_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; – Shot </span><span class="si">{</span><span class="n">shot_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Amplitude&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">plot_spectrogram_with_contours</span><span class="p">(</span><span class="n">Zxx_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">t_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">get_stft_contours</span><span class="p">(</span><span class="n">Zxx_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">t_list</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">shot_ids</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ds_list</span><span class="p">))]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[None, None, None, None]
</pre></div>
</div>
<img alt="../../_images/8bc1c4912881120fed788b57151cba55b39a100d6d7985610bfd7ddff09ae5ba.png" src="../../_images/8bc1c4912881120fed788b57151cba55b39a100d6d7985610bfd7ddff09ae5ba.png" />
<img alt="../../_images/b4d19cad19775c33d17c1a2831ad5f1ee72abf0ecc6aae08ba1eeb0c8cf10efc.png" src="../../_images/b4d19cad19775c33d17c1a2831ad5f1ee72abf0ecc6aae08ba1eeb0c8cf10efc.png" />
<img alt="../../_images/07a26ea05e5c1f84a858f34c316e7f77952ba3207346b343e91ad5cff46af64a.png" src="../../_images/07a26ea05e5c1f84a858f34c316e7f77952ba3207346b343e91ad5cff46af64a.png" />
<img alt="../../_images/6120a2fdb5b6116fbea1e38874f8a3d8fe2082ef271635aa86a1b0f7ed4fea66.png" src="../../_images/6120a2fdb5b6116fbea1e38874f8a3d8fe2082ef271635aa86a1b0f7ed4fea66.png" />
</div>
</div>
</section>
</section>
<section id="integrated-power-over-frequency-bands">
<h2>Integrated Power Over Frequency Bands<a class="headerlink" href="#integrated-power-over-frequency-bands" title="Link to this heading">#</a></h2>
<p>We’ll define bands (based on physics knowledge, e.g. 2/1 NTM ~10–15 kHz), then integrate STFT power over those frequency bands at each time step.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compute_band_power</span><span class="p">(</span><span class="n">Zxx</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">band_kHz</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute power over a specified frequency band at each time step.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - Zxx: STFT array (freq x time)</span>
<span class="sd">    - f: frequency array (Hz)</span>
<span class="sd">    - band_kHz: tuple (f_min_kHz, f_max_kHz)</span>

<span class="sd">    Returns:</span>
<span class="sd">    - time_series: 1D array of power vs time</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f_min_Hz</span> <span class="o">=</span> <span class="n">band_kHz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span>
    <span class="n">f_max_Hz</span> <span class="o">=</span> <span class="n">band_kHz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span>

    <span class="c1"># Select indices in frequency range</span>
    <span class="n">band_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span> <span class="o">&gt;=</span> <span class="n">f_min_Hz</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">f</span> <span class="o">&lt;=</span> <span class="n">f_max_Hz</span><span class="p">)</span>
    <span class="n">band_power</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Zxx</span><span class="p">[</span><span class="n">band_mask</span><span class="p">,</span> <span class="p">:])</span><span class="o">**</span><span class="mi">2</span>

    <span class="c1"># Integrate over frequency axis</span>
    <span class="n">power_vs_time</span> <span class="o">=</span> <span class="n">band_power</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">power_vs_time</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_band_power</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">band_kHz</span><span class="p">,</span> <span class="n">shot_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">band_kHz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">–</span><span class="si">{</span><span class="n">band_kHz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> kHz&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time [sec]&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Integrated Power&quot;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Power in </span><span class="si">{</span><span class="n">band_kHz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">–</span><span class="si">{</span><span class="n">band_kHz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> kHz Band&quot;</span>
    <span class="k">if</span> <span class="n">shot_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; – Shot </span><span class="si">{</span><span class="n">shot_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example: 2/1 NTM band from 10 to 15 kHz</span>
<span class="n">power</span> <span class="o">=</span> <span class="n">compute_band_power</span><span class="p">(</span><span class="n">Zxx_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">band_kHz</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="n">plot_band_power</span><span class="p">(</span><span class="n">t_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">power</span><span class="p">,</span> <span class="n">band_kHz</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">shot_id</span><span class="o">=</span><span class="n">shot_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/55321345add6ebf098614c65da0dd269daf5b351e3900d8a1138416a9ac38dd8.png" src="../../_images/55321345add6ebf098614c65da0dd269daf5b351e3900d8a1138416a9ac38dd8.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bands_kHz</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">)]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="n">bands_kHz</span><span class="p">:</span>
    <span class="n">power</span> <span class="o">=</span> <span class="n">compute_band_power</span><span class="p">(</span><span class="n">Zxx_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">band</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">power</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">band</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">–</span><span class="si">{</span><span class="n">band</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> kHz&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Band Power Comparison – Shot </span><span class="si">{</span><span class="n">shot_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time [sec]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Integrated Power&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/c5453a7555ea197f6b773288833e8e386bcbec695527ff364588b89e7d37e16f.png" src="../../_images/c5453a7555ea197f6b773288833e8e386bcbec695527ff364588b89e7d37e16f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_spectrogram_with_bands</span><span class="p">(</span><span class="n">Zxx</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">bands_kHz</span><span class="p">,</span> <span class="n">shot_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">):</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="kn">import</span> <span class="n">LogNorm</span>

    <span class="n">f_kHz</span> <span class="o">=</span> <span class="n">f</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="n">cax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">f_kHz</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Zxx</span><span class="p">),</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
                        <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>

    <span class="c1"># Overlay horizontal bands</span>
    <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="n">bands_kHz</span><span class="p">:</span>
        <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span> <span class="o">=</span> <span class="n">band</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">fmin</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">fmax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fmin</span><span class="si">}</span><span class="s2">–</span><span class="si">{</span><span class="n">fmax</span><span class="si">}</span><span class="s2"> kHz&quot;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time [sec]&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency [kHz]&quot;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;STFT with Mode Band Overlays&quot;</span>
    <span class="k">if</span> <span class="n">shot_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; – Shot </span><span class="si">{</span><span class="n">shot_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Amplitude&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bands_kHz</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">)]</span>  <span class="c1"># You can adjust based on expected modes</span>
<span class="n">plot_spectrogram_with_bands</span><span class="p">(</span><span class="n">Zxx_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bands_kHz</span><span class="p">,</span> <span class="n">shot_id</span><span class="o">=</span><span class="n">shot_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_1128234/3897467752.py:29: UserWarning: Creating legend with loc=&quot;best&quot; can be slow with large amounts of data.
  plt.tight_layout()
</pre></div>
</div>
<img alt="../../_images/35b9c4593082e88eec9a442bd776a6d97e74ce46eb37696d0b9513c37b3ee139.png" src="../../_images/35b9c4593082e88eec9a442bd776a6d97e74ce46eb37696d0b9513c37b3ee139.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compute_binary_mask</span><span class="p">(</span><span class="n">Zxx</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate binary mask of where |Zxx| &gt;= threshold.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Zxx</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">threshold</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.ndimage</span><span class="w"> </span><span class="kn">import</span> <span class="n">label</span>

<span class="k">def</span><span class="w"> </span><span class="nf">label_mode_events</span><span class="p">(</span><span class="n">binary_mask</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Label connected regions (events) in the binary mask.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    - labeled_mask: same shape as input, with each connected region labeled</span>
<span class="sd">    - num_events: number of detected blobs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">structure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>  <span class="c1"># allow diagonal connections</span>
    <span class="n">labeled_mask</span><span class="p">,</span> <span class="n">num_events</span> <span class="o">=</span> <span class="n">label</span><span class="p">(</span><span class="n">binary_mask</span><span class="p">,</span> <span class="n">structure</span><span class="o">=</span><span class="n">structure</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">labeled_mask</span><span class="p">,</span> <span class="n">num_events</span>
<span class="k">def</span><span class="w"> </span><span class="nf">extract_event_properties</span><span class="p">(</span><span class="n">labeled_mask</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">band_kHz</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract properties of each mode event that lies within a band.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    - labeled_mask: output of label()</span>
<span class="sd">    - f: frequency array (Hz)</span>
<span class="sd">    - t: time array (sec)</span>
<span class="sd">    - band_kHz: frequency band (tuple)</span>

<span class="sd">    Returns:</span>
<span class="sd">    - events: list of dicts with event properties</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">events</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">band_min</span> <span class="o">=</span> <span class="n">band_kHz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span>
    <span class="n">band_max</span> <span class="o">=</span> <span class="n">band_kHz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span>

    <span class="k">for</span> <span class="n">label_val</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">labeled_mask</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">labeled_mask</span> <span class="o">==</span> <span class="n">label_val</span><span class="p">)</span>
        <span class="n">freqs</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]]</span>
        <span class="n">times</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span>

        <span class="c1"># Check if event overlaps with the band</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">((</span><span class="n">freqs</span> <span class="o">&gt;=</span> <span class="n">band_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">freqs</span> <span class="o">&lt;=</span> <span class="n">band_max</span><span class="p">)):</span>
            <span class="n">event</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">label_val</span><span class="p">,</span>
                <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="n">times</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                <span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="n">times</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">times</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">times</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                <span class="s2">&quot;min_freq_kHz&quot;</span><span class="p">:</span> <span class="n">freqs</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span>
                <span class="s2">&quot;max_freq_kHz&quot;</span><span class="p">:</span> <span class="n">freqs</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span>
                <span class="s2">&quot;band&quot;</span><span class="p">:</span> <span class="n">band_kHz</span>
            <span class="p">}</span>
            <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">events</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">Rectangle</span>

<span class="k">def</span><span class="w"> </span><span class="nf">display_event_table</span><span class="p">(</span><span class="n">events</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">Zxx</span> <span class="o">=</span> <span class="n">Zxx_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">f_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">t_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">mask</span> <span class="o">=</span> <span class="n">compute_binary_mask</span><span class="p">(</span><span class="n">Zxx</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
<span class="n">labeled_mask</span><span class="p">,</span> <span class="n">num_events</span> <span class="o">=</span> <span class="n">label_mode_events</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<span class="n">events</span> <span class="o">=</span> <span class="n">extract_event_properties</span><span class="p">(</span><span class="n">labeled_mask</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">band_kHz</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="n">display_event_table</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>label</th>
      <th>start_time</th>
      <th>end_time</th>
      <th>duration</th>
      <th>min_freq_kHz</th>
      <th>max_freq_kHz</th>
      <th>band</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0.102000</td>
      <td>0.522001</td>
      <td>0.420001</td>
      <td>0.000000</td>
      <td>249.999500</td>
      <td>(10, 15)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>23</td>
      <td>0.104000</td>
      <td>0.106000</td>
      <td>0.002000</td>
      <td>10.249980</td>
      <td>11.499977</td>
      <td>(10, 15)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>24</td>
      <td>0.412001</td>
      <td>0.412001</td>
      <td>0.000000</td>
      <td>10.249980</td>
      <td>10.499979</td>
      <td>(10, 15)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>25</td>
      <td>0.380001</td>
      <td>0.380001</td>
      <td>0.000000</td>
      <td>10.999978</td>
      <td>10.999978</td>
      <td>(10, 15)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>26</td>
      <td>0.244000</td>
      <td>0.244000</td>
      <td>0.000000</td>
      <td>11.249978</td>
      <td>11.749977</td>
      <td>(10, 15)</td>
    </tr>
    <tr>
      <th>5</th>
      <td>27</td>
      <td>0.104000</td>
      <td>0.104000</td>
      <td>0.000000</td>
      <td>11.999976</td>
      <td>11.999976</td>
      <td>(10, 15)</td>
    </tr>
    <tr>
      <th>6</th>
      <td>28</td>
      <td>0.416001</td>
      <td>0.416001</td>
      <td>0.000000</td>
      <td>11.999976</td>
      <td>11.999976</td>
      <td>(10, 15)</td>
    </tr>
    <tr>
      <th>7</th>
      <td>29</td>
      <td>0.374001</td>
      <td>0.376001</td>
      <td>0.002000</td>
      <td>12.249976</td>
      <td>12.749975</td>
      <td>(10, 15)</td>
    </tr>
    <tr>
      <th>8</th>
      <td>30</td>
      <td>0.104000</td>
      <td>0.106000</td>
      <td>0.002000</td>
      <td>12.499975</td>
      <td>12.999974</td>
      <td>(10, 15)</td>
    </tr>
    <tr>
      <th>9</th>
      <td>31</td>
      <td>0.380001</td>
      <td>0.380001</td>
      <td>0.000000</td>
      <td>12.749975</td>
      <td>13.249974</td>
      <td>(10, 15)</td>
    </tr>
    <tr>
      <th>10</th>
      <td>32</td>
      <td>0.392001</td>
      <td>0.392001</td>
      <td>0.000000</td>
      <td>13.249974</td>
      <td>13.499973</td>
      <td>(10, 15)</td>
    </tr>
    <tr>
      <th>11</th>
      <td>33</td>
      <td>0.104000</td>
      <td>0.106000</td>
      <td>0.002000</td>
      <td>13.749973</td>
      <td>14.499971</td>
      <td>(10, 15)</td>
    </tr>
    <tr>
      <th>12</th>
      <td>34</td>
      <td>0.380001</td>
      <td>0.382001</td>
      <td>0.002000</td>
      <td>13.999972</td>
      <td>14.249972</td>
      <td>(10, 15)</td>
    </tr>
    <tr>
      <th>13</th>
      <td>35</td>
      <td>0.396001</td>
      <td>0.396001</td>
      <td>0.000000</td>
      <td>13.999972</td>
      <td>14.249972</td>
      <td>(10, 15)</td>
    </tr>
    <tr>
      <th>14</th>
      <td>36</td>
      <td>0.392001</td>
      <td>0.394001</td>
      <td>0.002000</td>
      <td>14.499971</td>
      <td>14.749971</td>
      <td>(10, 15)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">Rectangle</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="kn">import</span> <span class="n">LogNorm</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_spectrogram_with_events</span><span class="p">(</span><span class="n">Zxx</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">shot_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot STFT with bounding boxes around detected mode events.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - Zxx: STFT array (freq x time)</span>
<span class="sd">    - f: frequency array (Hz)</span>
<span class="sd">    - t: time array (sec)</span>
<span class="sd">    - events: list of dicts from extract_event_properties()</span>
<span class="sd">    - shot_id: Optional shot ID</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f_kHz</span> <span class="o">=</span> <span class="n">f</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="n">cax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">f_kHz</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Zxx</span><span class="p">),</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
                        <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;end_time&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;min_freq_kHz&#39;</span><span class="p">]</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;max_freq_kHz&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;min_freq_kHz&#39;</span><span class="p">]</span>
        <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;band&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">–</span><span class="si">{</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;band&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> kHz&quot;</span>

        <span class="n">rect</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span>
                         <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time [sec]&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency [kHz]&quot;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;STFT with Detected Mode Events&quot;</span>
    <span class="k">if</span> <span class="n">shot_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; – Shot </span><span class="si">{</span><span class="n">shot_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Amplitude&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="n">compute_binary_mask</span><span class="p">(</span><span class="n">Zxx_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
<span class="n">labeled_mask</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">label_mode_events</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<span class="n">events</span> <span class="o">=</span> <span class="n">extract_event_properties</span><span class="p">(</span><span class="n">labeled_mask</span><span class="p">,</span> <span class="n">f_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">band_kHz</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>

<span class="n">plot_spectrogram_with_events</span><span class="p">(</span><span class="n">Zxx_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">events</span><span class="p">,</span> <span class="n">shot_id</span><span class="o">=</span><span class="n">shot_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/3f65dce20daced7a1ac16e866f3b60ebb373ff6ae0b472120b37b9945a7f7b30.png" src="../../_images/3f65dce20daced7a1ac16e866f3b60ebb373ff6ae0b472120b37b9945a7f7b30.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_spectrogram_with_events</span><span class="p">(</span><span class="n">Zxx</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">shot_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">):</span>

    <span class="n">f_kHz</span> <span class="o">=</span> <span class="n">f</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="c1"># cax = ax.pcolormesh(t, f_kHz, np.abs(Zxx), shading=&#39;nearest&#39;,</span>
    <span class="c1">#                     norm=LogNorm(vmin=vmin), cmap=&#39;jet&#39;)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">event</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">events</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;end_time&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;min_freq_kHz&#39;</span><span class="p">]</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;max_freq_kHz&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;min_freq_kHz&#39;</span><span class="p">]</span>
        <span class="n">band_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;band&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">–</span><span class="si">{</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;band&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> kHz&quot;</span>

        <span class="n">rect</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span>
                         <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>
                         <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mf">0.002</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">height</span> <span class="o">+</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">band_str</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">))</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time [sec]&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency [kHz]&quot;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;STFT with Detected Mode Events&quot;</span>
    <span class="k">if</span> <span class="n">shot_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; – Shot </span><span class="si">{</span><span class="n">shot_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Amplitude&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="n">compute_binary_mask</span><span class="p">(</span><span class="n">Zxx_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
<span class="n">labeled_mask</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">label_mode_events</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<span class="n">events</span> <span class="o">=</span> <span class="n">extract_event_properties</span><span class="p">(</span><span class="n">labeled_mask</span><span class="p">,</span> <span class="n">f_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">band_kHz</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>

<span class="n">plot_spectrogram_with_events</span><span class="p">(</span><span class="n">Zxx_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">events</span><span class="p">,</span> <span class="n">shot_id</span><span class="o">=</span><span class="n">shot_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">53</span><span class="p">],</span> <span class="n">line</span> <span class="mi">5</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">labeled_mask</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">label_mode_events</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">events</span> <span class="o">=</span> <span class="n">extract_event_properties</span><span class="p">(</span><span class="n">labeled_mask</span><span class="p">,</span> <span class="n">f_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">band_kHz</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="ne">----&gt; </span><span class="mi">5</span> <span class="n">plot_spectrogram_with_events</span><span class="p">(</span><span class="n">Zxx_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">events</span><span class="p">,</span> <span class="n">shot_id</span><span class="o">=</span><span class="n">shot_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="nn">Cell In[52], line 31,</span> in <span class="ni">plot_spectrogram_with_events</span><span class="nt">(Zxx, f, t, events, shot_id, vmin)</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span>     <span class="n">title</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; – Shot </span><span class="si">{</span><span class="n">shot_id</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">30</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">31</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Amplitude&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span> <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span> <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="ne">NameError</span>: name &#39;cax&#39; is not defined
</pre></div>
</div>
<img alt="../../_images/4985614d5f8aa3848e357dce46cd410f2913c9700d821110e26abec205d4b9d3.png" src="../../_images/4985614d5f8aa3848e357dce46cd410f2913c9700d821110e26abec205d4b9d3.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="n">compute_binary_mask</span><span class="p">(</span><span class="n">Zxx_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
<span class="n">labeled_mask</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">label_mode_events</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<span class="n">events</span> <span class="o">=</span> <span class="n">extract_event_properties</span><span class="p">(</span><span class="n">labeled_mask</span><span class="p">,</span> <span class="n">f_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">band_kHz</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>

<span class="n">plot_spectrogram_with_events</span><span class="p">(</span><span class="n">Zxx_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">events</span><span class="p">,</span> <span class="n">shot_id</span><span class="o">=</span><span class="n">shot_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/59e5f4005d541a3830c5d38bd6fd1cb3405b2f4e27d04f63fc6a53dd688fdf73.png" src="../../_images/59e5f4005d541a3830c5d38bd6fd1cb3405b2f4e27d04f63fc6a53dd688fdf73.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="n">compute_binary_mask</span><span class="p">(</span><span class="n">Zxx_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
<span class="n">labeled_mask</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">label_mode_events</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<span class="n">events</span> <span class="o">=</span> <span class="n">extract_event_properties</span><span class="p">(</span><span class="n">labeled_mask</span><span class="p">,</span> <span class="n">f_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">band_kHz</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>

<span class="n">plot_spectrogram_with_events</span><span class="p">(</span><span class="n">Zxx_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">events</span><span class="p">,</span> <span class="n">shot_id</span><span class="o">=</span><span class="n">shot_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">54</span><span class="p">],</span> <span class="n">line</span> <span class="mi">5</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">labeled_mask</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">label_mode_events</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">events</span> <span class="o">=</span> <span class="n">extract_event_properties</span><span class="p">(</span><span class="n">labeled_mask</span><span class="p">,</span> <span class="n">f_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">band_kHz</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
<span class="ne">----&gt; </span><span class="mi">5</span> <span class="n">plot_spectrogram_with_events</span><span class="p">(</span><span class="n">Zxx_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">events</span><span class="p">,</span> <span class="n">shot_id</span><span class="o">=</span><span class="n">shot_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="nn">Cell In[52], line 31,</span> in <span class="ni">plot_spectrogram_with_events</span><span class="nt">(Zxx, f, t, events, shot_id, vmin)</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span>     <span class="n">title</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; – Shot </span><span class="si">{</span><span class="n">shot_id</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">30</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">31</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Amplitude&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span> <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span> <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="ne">NameError</span>: name &#39;cax&#39; is not defined
</pre></div>
</div>
<img alt="../../_images/c51ba8a950cb704b82f6af7fe1ded615f9ab7b62a8229d64454817a7ce90619f.png" src="../../_images/c51ba8a950cb704b82f6af7fe1ded615f9ab7b62a8229d64454817a7ce90619f.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Theory/3. MHD modes"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="5.%20Ridge%20detection.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Ridge detection</p>
      </div>
    </a>
    <a class="right-next"
       href="../../Libraries/Python/intro.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Python Libraries</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> 
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#short-time-fourier-transform-stft">Short-Time Fourier Transform (STFT)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inspect-amplitude-distribution">Inspect amplitude distribution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#integrated-power-over-frequency-bands">Integrated Power Over Frequency Bands</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/praksharma/Knowledge-Base/edit/main/docs/Theory/3. MHD modes/6. Contour detection.ipynb">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/Theory/3. MHD modes/6. Contour detection.ipynb"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, By Prakhar Sharma.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__center">
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>